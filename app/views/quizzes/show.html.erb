<%= render 'quizzes/total_score' %>

<div class="container">
    <% @quiz.ripostes.each do |riposte| %>
        <% question = riposte.question %>
        <div class="container singleOption topic">
            <h5 style="color:gray;">Question ID #<%= question.id %></h5>
            <div class="singleOption lowSingOpt">
                <div class="row">
                    <div class="col-sm-6">
                        <%= question.prompt %>
                    </div>
                    <div class="col-sm-6">
                        <% picture = question.picture %>
                        <%= image_tag(picture.image_url(:quiz_size).to_s) if picture.present? %>
                    </div>
                </div>
            </div>
            </br>
            
            <div class="row">
                <div class="col-sm-6">
                    <h4>Your Response</h4>
                    <% these_answers = question.correct_answers %>
                    <% if these_answers.present? %>
                        <% correct_array_fixed = these_answers.map{|e| e.downcase.gsub(/\s+/, "").gsub(/[()]/, "")} %>
                    <% else %>
                        <% correct_array_fixed = [] %>
                    <% end %>
                    <% riposte.stud_answer.each do |response| %>
                        <% if question.label.grade_type == "computer" then %>
                            <% if question.style == "interval" then %>
                                <% class_type = "red" %>
                                <% class_type = "green" if riposte.stud_answer[0].to_f.between?(these_answers[0].to_f,these_answers[1].to_f) %>
                            <% else %>
                                <% fixed_response = response.to_s.downcase.gsub(/\s+/, "").gsub(/[()]/, "") %>
                                <% class_type = (correct_array_fixed.include?(fixed_response) ? "green" : "red") %>
                            <% end %>
                        <% else %>
                            <% class_type == "" %>
                        <% end %>
                        <p class=<%= class_type %>><%= response %></p>
                    <% end %>
                </div>
                <div class="col-sm-6">
                    <% show_samples = false %>
                    <% show_samples = true if @offer_next_try == "none" %>

                    <% if question.label.grade_type == "computer" %>
                        <% first_phrase = "Correct Responses" %>
                        <% show_samples = true %>
                    <% else %>
                        <% first_phrase = "Example Responses" %>
                        <h4>Your teacher will grade this question.</h4>
                    <% end %>

                    <% if these_answers.present? %>
                        <% if show_samples %>
                            <h4><%= first_phrase %></h4>
                            <% if question.style == "interval" %>
                                <p>Between <%= these_answers.first %> and <%= these_answers.second %></p>
                            <% else %>
                                <% these_answers.each_with_index do |answer, index| %>
                                    <li>
                                        <%= answer %>
                                    </li>
                                <% end %>
                            <% end %>
                        <% else %>
                            <h4>We will show a sample answer after you use your last key for this quiz.</h4>
                        <% end %>
                    <% end %>

                </div>
            </div>
        </div>
        </br>
    <% end %>
</div>

<div class="container">
    <div class="row">
        <% if @offer_next_try == "none" %>
            <div class="singleOption">
                You have used all your keys for this quiz.
            </div>
        <% else %>
            <%= link_to "Try this quiz again",
                {:controller => "quizzes", :action => "new", :objective_id => @objective.id, :origin => @offer_next_try}, 
                :class => "btn btn-lg btn-primary plain_link" %>
        <% end %>
        <%= link_to "Back to Your Class Page", 
            seminar_student_path(current_user.seminar_students.find_by(:seminar => current_user.current_class)),
            :class => "btn btn-lg btn-primary plain_link" %>
    </div>
</div>
</br>

<%= render 'quizzes/total_score' %>

